"use strict";(globalThis.webpackChunkbook=globalThis.webpackChunkbook||[]).push([[689],{8135:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"module-1/ch1-ros2-basics/services","title":"Services - Request and Response","description":"Estimated Reading Time: 7 minutes","source":"@site/docs/module-1/ch1-ros2-basics/03-services.md","sourceDirName":"module-1/ch1-ros2-basics","slug":"/module-1/ch1-ros2-basics/services","permalink":"/physical-ai-textbook/docs/module-1/ch1-ros2-basics/services","draft":false,"unlisted":false,"editUrl":"https://github.com/92Bilal26/physical-ai-textbook/tree/main/docs/module-1/ch1-ros2-basics/03-services.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"Services - Request and Response"},"sidebar":"tutorialSidebar","previous":{"title":"Topics - Publish and Subscribe","permalink":"/physical-ai-textbook/docs/module-1/ch1-ros2-basics/topics"},"next":{"title":"Chapter 1 Exercises","permalink":"/physical-ai-textbook/docs/module-1/ch1-ros2-basics/exercises"}}');var i=s(4848),t=s(8453);const l={title:"Services - Request and Response"},c="Section 3: Services - Request and Response",a={},d=[{value:"When Topics Aren&#39;t Enough",id:"when-topics-arent-enough",level:2},{value:"Topics vs. Services",id:"topics-vs-services",level:3},{value:"What is a Service?",id:"what-is-a-service",level:2},{value:"Code Example 3: Service Client and Server",id:"code-example-3-service-client-and-server",level:2},{value:"Service Definition",id:"service-definition",level:3},{value:"Service Server",id:"service-server",level:3},{value:"Service Client",id:"service-client",level:3},{value:"Using Services from Command Line",id:"using-services-from-command-line",level:2},{value:"Start Server (Terminal 1)",id:"start-server-terminal-1",level:3},{value:"Call Service (Terminal 2)",id:"call-service-terminal-2",level:3},{value:"Run Client (Terminal 3)",id:"run-client-terminal-3",level:3},{value:"Services in the Real World",id:"services-in-the-real-world",level:2},{value:"Example 1: Robot Navigation",id:"example-1-robot-navigation",level:3},{value:"Example 2: Sensor Calibration",id:"example-2-sensor-calibration",level:3},{value:"Example 3: Get Robot Status",id:"example-3-get-robot-status",level:3},{value:"Services vs. Topics: Decision Guide",id:"services-vs-topics-decision-guide",level:2},{value:"Key Takeaways",id:"key-takeaways",level:2},{value:"Try It Yourself",id:"try-it-yourself",level:2},{value:"Next: Putting It Together",id:"next-putting-it-together",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",input:"input",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"section-3-services---request-and-response",children:"Section 3: Services - Request and Response"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Estimated Reading Time"}),": 7 minutes\r\n",(0,i.jsx)(n.strong,{children:"Bloom's Level"}),": Understand, Apply\r\n",(0,i.jsx)(n.strong,{children:"Key Learning"}),": Synchronous request/response communication"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"when-topics-arent-enough",children:"When Topics Aren't Enough"}),"\n",(0,i.jsx)(n.p,{children:"Topics are great for streaming data, but what if you need:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"A response to a request?"}),"\n",(0,i.jsx)(n.li,{children:"Guaranteed delivery?"}),"\n",(0,i.jsx)(n.li,{children:"Synchronous wait-for-answer behavior?"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["That's where ",(0,i.jsx)(n.strong,{children:"services"})," come in."]}),"\n",(0,i.jsx)(n.h3,{id:"topics-vs-services",children:"Topics vs. Services"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Aspect"}),(0,i.jsx)(n.th,{children:"Topic"}),(0,i.jsx)(n.th,{children:"Service"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Communication"}),(0,i.jsx)(n.td,{children:"One-way (async)"}),(0,i.jsx)(n.td,{children:"Two-way (sync)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Pattern"}),(0,i.jsx)(n.td,{children:"Publish/Subscribe"}),(0,i.jsx)(n.td,{children:"Request/Response"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Waiting"}),(0,i.jsx)(n.td,{children:"No"}),(0,i.jsx)(n.td,{children:"Yes (caller waits)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Use Case"}),(0,i.jsx)(n.td,{children:"Sensor data, streams"}),(0,i.jsx)(n.td,{children:"Commands, queries"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Example"}),(0,i.jsx)(n.td,{children:"Camera images"}),(0,i.jsx)(n.td,{children:"Move robot to X,Y"})]})]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"what-is-a-service",children:"What is a Service?"}),"\n",(0,i.jsxs)(n.p,{children:["A ",(0,i.jsx)(n.strong,{children:"service"})," is a synchronous request/response call between nodes."]}),"\n",(0,i.jsx)(n.p,{children:"Like a phone call:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Client"}),": Calls and waits for answer"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Server"}),": Receives call and responds"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Service Name"}),": The phone number (e.g., ",(0,i.jsx)(n.code,{children:"/add_two_ints"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Request/Response"}),": What's asked and what's answered"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"code-example-3-service-client-and-server",children:"Code Example 3: Service Client and Server"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Location"}),": ",(0,i.jsx)(n.code,{children:"code-examples/ros2_packages/service_example_py/"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Generated by"}),": ",(0,i.jsx)(n.code,{children:"ros2-code-generator"})," skill"]}),"\n",(0,i.jsx)(n.h3,{id:"service-definition",children:"Service Definition"}),"\n",(0,i.jsx)(n.p,{children:"First, define what the service looks like:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# File: service_example_py/service_example_py/add_two_ints.srv\r\nint64 a\r\nint64 b\r\n---\r\nint64 sum\n"})}),"\n",(0,i.jsxs)(n.p,{children:["(The ",(0,i.jsx)(n.code,{children:"---"})," separates request from response)"]}),"\n",(0,i.jsx)(n.h3,{id:"service-server",children:"Service Server"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# File: service_example_py/service_example_py/server.py\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom example_interfaces.srv import AddTwoInts\r\n\r\nclass AddServerNode(Node):\r\n    def __init__(self):\r\n        super().__init__('add_server')\r\n\r\n        # Create a service\r\n        self.srv = self.create_service(\r\n            AddTwoInts,\r\n            '/add_two_ints',\r\n            self.add_two_ints_callback\r\n        )\r\n\r\n    def add_two_ints_callback(self, request, response):\r\n        # Handle incoming request\r\n        response.sum = request.a + request.b\r\n        self.get_logger().info(\r\n            f'Incoming request: a={request.a}, b={request.b}'\r\n        )\r\n        self.get_logger().info(f'Sending back response: {response.sum}')\r\n        return response\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = AddServerNode()\r\n    self.get_logger().info('Service ready')\r\n    rclpy.spin(node)\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,i.jsx)(n.h3,{id:"service-client",children:"Service Client"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# File: service_example_py/service_example_py/client.py\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom example_interfaces.srv import AddTwoInts\r\n\r\nclass AddClientNode(Node):\r\n    def __init__(self):\r\n        super().__init__('add_client')\r\n\r\n        # Create a client\r\n        self.client = self.create_client(\r\n            AddTwoInts,\r\n            '/add_two_ints'\r\n        )\r\n\r\n        # Wait for service to be available\r\n        while not self.client.wait_for_service(timeout_sec=1.0):\r\n            self.get_logger().info('Service not available, waiting...')\r\n\r\n        # Make a request\r\n        self.send_request()\r\n\r\n    def send_request(self):\r\n        # Create request\r\n        request = AddTwoInts.Request()\r\n        request.a = 5\r\n        request.b = 3\r\n\r\n        # Send request (blocks until response)\r\n        self.future = self.client.call_async(request)\r\n\r\n        # Continue processing (don't block main thread)\r\n        rclpy.spin_until_future_complete(\r\n            self,\r\n            self.future\r\n        )\r\n\r\n        # Handle response\r\n        if self.future.result() is not None:\r\n            response = self.future.result()\r\n            self.get_logger().info(f'Result: 5 + 3 = {response.sum}')\r\n        else:\r\n            self.get_logger().error('Service call failed!')\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = AddClientNode()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"using-services-from-command-line",children:"Using Services from Command Line"}),"\n",(0,i.jsx)(n.h3,{id:"start-server-terminal-1",children:"Start Server (Terminal 1)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ros2 run service_example_py server\n"})}),"\n",(0,i.jsx)(n.p,{children:"Output:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"[INFO] [add_server]: Service ready\r\n[INFO] [add_server]: Incoming request: a=5, b=3\r\n[INFO] [add_server]: Sending back response: 8\n"})}),"\n",(0,i.jsx)(n.h3,{id:"call-service-terminal-2",children:"Call Service (Terminal 2)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ros2 service call /add_two_ints example_interfaces/srv/AddTwoInts '{a: 5, b: 3}'\n"})}),"\n",(0,i.jsx)(n.p,{children:"Output:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"requester: making request #1 of 1 with values\r\na: 5\r\nb: 3\r\n\r\nresponse:\r\nsum: 8\n"})}),"\n",(0,i.jsx)(n.h3,{id:"run-client-terminal-3",children:"Run Client (Terminal 3)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ros2 run service_example_py client\n"})}),"\n",(0,i.jsx)(n.p,{children:"Output:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"[INFO] [add_client]: Service not available, waiting...\r\n[INFO] [add_client]: Result: 5 + 3 = 8\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"services-in-the-real-world",children:"Services in the Real World"}),"\n",(0,i.jsx)(n.h3,{id:"example-1-robot-navigation",children:"Example 1: Robot Navigation"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'Client Node: User says "go to kitchen"\r\n    \u2193\r\nService: /navigate\r\n    \u2193\r\nServer Node: Navigation system processes request\r\n    \u2193\r\nResponse: "Arrived at kitchen"\n'})}),"\n",(0,i.jsx)(n.h3,{id:"example-2-sensor-calibration",children:"Example 2: Sensor Calibration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'Client: "Calibrate IMU"\r\n    \u2193\r\nService: /calibrate_imu\r\n    \u2193\r\nServer: Runs calibration routine\r\n    \u2193\r\nResponse: "Calibration complete, offsets: ..."\n'})}),"\n",(0,i.jsx)(n.h3,{id:"example-3-get-robot-status",children:"Example 3: Get Robot Status"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'Client: "What\'s your battery level?"\r\n    \u2193\r\nService: /get_status\r\n    \u2193\r\nServer: Reads sensors\r\n    \u2193\r\nResponse: "Battery: 85%, Temp: 45C"\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"services-vs-topics-decision-guide",children:"Services vs. Topics: Decision Guide"}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.strong,{children:"Topic"})," when:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Streaming continuous data (sensors, state)"}),"\n",(0,i.jsx)(n.li,{children:"Multiple subscribers needed"}),"\n",(0,i.jsx)(n.li,{children:"Asynchronous is fine"}),"\n",(0,i.jsx)(n.li,{children:"High-frequency messages"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.strong,{children:"Service"})," when:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Request/response pattern"}),"\n",(0,i.jsx)(n.li,{children:"Synchronous answer required"}),"\n",(0,i.jsx)(n.li,{children:"Single requester"}),"\n",(0,i.jsx)(n.li,{children:"Configuration or command"}),"\n",(0,i.jsx)(n.li,{children:"Query for information"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"key-takeaways",children:"Key Takeaways"}),"\n",(0,i.jsx)(n.p,{children:"\u2705 Services enable synchronous request/response\r\n\u2705 Server listens for requests and responds\r\n\u2705 Client sends request and waits for response\r\n\u2705 Services are typed with request/response definitions\r\n\u2705 Use services for commands and queries\r\n\u2705 Use topics for streaming data"}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"try-it-yourself",children:"Try It Yourself"}),"\n",(0,i.jsx)(n.p,{children:"Try modifying the service example:"}),"\n",(0,i.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Add two numbers with different values"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Use ",(0,i.jsx)(n.code,{children:"ros2 service call"})," from command line"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Modify server to do division instead of addition"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Create a service that returns multiple values in response"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Handle error cases (e.g., division by zero)"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"next-putting-it-together",children:"Next: Putting It Together"}),"\n",(0,i.jsx)(n.p,{children:"You now understand:\r\n\u2705 Nodes (Section 1)\r\n\u2705 Topics - streaming communication (Section 2)\r\n\u2705 Services - request/response (Section 3)"}),"\n",(0,i.jsx)(n.p,{children:"It's time to practice with exercises!"}),"\n",(0,i.jsxs)(n.p,{children:["\ud83d\udc49 ",(0,i.jsx)(n.strong,{children:"Next"}),": ",(0,i.jsx)(n.a,{href:"/physical-ai-textbook/docs/module-1/ch1-ros2-basics/exercises",children:"Exercises"})]}),"\n",(0,i.jsx)(n.p,{children:"Or review:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/physical-ai-textbook/docs/module-1/ch1-ros2-basics/nodes",children:"Section 1: Nodes"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/physical-ai-textbook/docs/module-1/ch1-ros2-basics/topics",children:"Section 2: Topics"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/physical-ai-textbook/docs/module-1/ch1-ros2-basics/summary",children:"Summary"})}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Section Status"}),": Complete \u2705\r\n",(0,i.jsx)(n.strong,{children:"Skills Used"}),": ",(0,i.jsx)(n.code,{children:"ros2-code-generator"}),", ",(0,i.jsx)(n.code,{children:"code-explainer"})]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>c});var r=s(6540);const i={},t=r.createContext(i);function l(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);